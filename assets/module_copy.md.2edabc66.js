import{_ as s,c as a,o as n,N as l}from"./chunks/framework.bf75d690.js";const A=JSON.parse('{"title":"copy 模块","description":"","frontmatter":{},"headers":[],"relativePath":"module/copy.md","lastUpdated":1678790476000}'),o={name:"module/copy.md"},t=l(`<h1 id="copy-模块" tabindex="-1">copy 模块 <a class="header-anchor" href="#copy-模块" aria-label="Permalink to &quot;copy 模块&quot;">​</a></h1><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#ansible-collections-ansible-builtin-copy-module" target="_blank" rel="noreferrer">copy 模块</a> 是远程推送数据模块，只能将数据推送到远程主机节点。无法拉取数据到本地。</p><h2 id="常用参数" tabindex="-1">常用参数 <a class="header-anchor" href="#常用参数" aria-label="Permalink to &quot;常用参数&quot;">​</a></h2><table><thead><tr><th>参数名</th><th>是否必须</th><th>默认值</th><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><strong><code>src</code></strong></td><td>否</td><td></td><td></td><td><small>用于定位ansible执行的机器上的文件，需要使用绝对路径。<br> 如果拷贝的是文件夹，那么文件夹会整体拷贝。<br>如果结尾是<code>/</code>,那么只有文件夹内的东西被拷贝。</small></td></tr><tr><td><strong><code>content</code></strong></td><td>否</td><td></td><td></td><td>用于代替 <code>src</code>，用于指定文件的内容，拷贝到远程主机。</td></tr><tr><td><strong><code>dest</code></strong></td><td>是</td><td></td><td></td><td><small>用于定位远程节点上的文件，需要绝对路径。<br>如果 <code>src</code> 指向的是文件夹，这个参数也必须是指向文件夹。</small></td></tr><tr><td><strong><code>backup</code></strong></td><td>否</td><td>否</td><td><code>true/false</code></td><td>备份远程节点上的原始文件，在拷贝之前。如果发生什么意外，原始文件还能使用。</td></tr><tr><td><strong><code>directory_mode</code></strong></td><td>否</td><td></td><td></td><td><small>进行递归复制时，设置目录的模式。<br> 如果未设置，将使用系统默认值。<br>只对新创建的目录设置，不影响已经存在的目录。</small></td></tr><tr><td><strong><code>follow</code></strong></td><td>否</td><td>否</td><td><code>true/false</code></td><td>当拷贝的文件夹内有链接存在的时候，那么拷贝过去的也会有链接</td></tr><tr><td><strong><code>force</code></strong></td><td>否</td><td><code>true</code></td><td><code>true/false</code></td><td><small>默认为 <code>true</code> 会覆盖远程的内容不一样的文件（可能文件名一样）。<br>如果是 <code>false</code>，远程存在这个文件就不会拷贝</small></td></tr><tr><td><strong><code>group</code></strong></td><td>否</td><td></td><td></td><td>设定一个群组拥有拷贝到远程节点的文件权限</td></tr><tr><td><strong><code>mode</code></strong></td><td>否</td><td></td><td></td><td>等同于 <code>chmod</code> 命令参数，可以配置成 <code>u+rwx</code> 或者 <code>u=rw,g=r,o=r</code></td></tr><tr><td><strong><code>owner</code></strong></td><td>否</td><td></td><td></td><td>设定一个用户拥有拷贝到远程节点的文件权限</td></tr></tbody></table><p>更多参数可以使用命令 <code>ansible-doc -s copy</code> 获取更多使用相关的文档或者<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html#parameters" target="_blank" rel="noreferrer">查看官方文档</a>。</p><h2 id="一些示例" tabindex="-1">一些示例 <a class="header-anchor" href="#一些示例" aria-label="Permalink to &quot;一些示例&quot;">​</a></h2><h3 id="发送文件" tabindex="-1">发送文件 <a class="header-anchor" href="#发送文件" aria-label="Permalink to &quot;发送文件&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 新建一个文件</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/ansible-copy.txt</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 发送 /tmp/ansible-copy.txt 文件</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src=/tmp/ansible-copy.txt dest=/tmp/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看拷贝的文件</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">shell</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ls -l /tmp/ansible-copy.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><blockquote><p><code>ansible</code> 模块记录了文件属性，文件md5值，得到了文件的唯一校验值，判断文件的内容是否变化，如果没有变化则不做处理，提升批量管理的效率。</p></blockquote><h3 id="指定文件属性" tabindex="-1">指定文件属性 <a class="header-anchor" href="#指定文件属性" aria-label="Permalink to &quot;指定文件属性&quot;">​</a></h3><p>将权限修改为 <strong>600</strong>，文件属主修改为 <code>www</code>（保证在远程机器存在这个 <code>www</code> 用户）</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 新建 www 用户</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">shell</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">useradd www</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 新建一个文件</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/ansible-copy.txt</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 发送 /tmp/ansible-copy.txt 文件</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src=/tmp/ansible-copy.txt dest=/tmp/ group=www owner=www mode=600</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看拷贝的文件</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">shell</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ls -l /tmp/ansible-copy.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h3 id="备份文件" tabindex="-1">备份文件 <a class="header-anchor" href="#备份文件" aria-label="Permalink to &quot;备份文件&quot;">​</a></h3><p>使用 <code>backup</code> 参数防止覆盖远程服务器文件，提前备份目标机器文件。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 新建一个文件</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello world!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/ansible-copy.txt</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 发送 /tmp/ansible-copy.txt 文件</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src=/tmp/ansible-copy.txt dest=/tmp/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 修改文件内容</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hi world</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/ansible-copy.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 拷贝文件时添加备份</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src=/tmp/ansible-copy.txt dest=/tmp/ backup=true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h3 id="直接传递内容" tabindex="-1">直接传递内容 <a class="header-anchor" href="#直接传递内容" aria-label="Permalink to &quot;直接传递内容&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">copy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content=&#39;hi curder&#39; dest=/tmp/ansible-copy.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看内容</span></span>
<span class="line"><span style="color:#FFCB6B;">ansible</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src/inventory.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">shell</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cat /tmp/ansible-copy.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>不需要提供源文件，而直接使用字符串传递到远程服务器，建议添加 <code>backup=true</code> 参数。</p></blockquote>`,18),p=[t];function e(c,r,y,C,d,D){return n(),a("div",null,p)}const h=s(o,[["render",e]]);export{A as __pageData,h as default};
